<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Up Sprint</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="dashboard.css">
    <style>
        /* Basic styling for the new elements */
        .repo-link-container {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        .repo-link-container a {
            font-size: 1.1em;
            color: #3B7CDA;
            text-decoration: underline;
            word-break: break-all;
            display: inline-block;
            margin: 5px 0;
        }
        .copy-btn {
            margin-left: 8px;
            padding: 2px 6px;
            font-size: 12px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
        }
        .download-report-btn {
            margin: 20px auto;
            display: block;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
    </style>
</head>
<body>
    
<div id="container">
    <div class="dashboard-container">
        <div class="card-pane"> 
            <div class="header-section">
                <div class="logo">
                    <img src="logo.png" alt="Start Up Sprint Logo">
                    <span class="logo-text">GoStarterAI</span>
                </div>
                <div id="business-info">
                    <h1 id="business-name"></h1>
                    <div id="repo-link-container" class="repo-link-container">
                        <!-- Links will be injected dynamically -->
                    </div>
                    <button id="download-report-btn" class="download-report-btn">Download Market Report</button>
                    <button id="host-repo" class="vercel">Host Your Landing Page</button>
                </div>
            </div>
            
<div class="website-preview-card">
    <h2 class="preview-heading">Website Preview</h2>
    <div id="edit-buttons-container" style="margin-top:10px;">
        <button id="toggle-edit-btn" class="edit-btn">Edit Text</button>
        <button id="save-edit-btn" class="edit-btn" style="display:none;">Save Changes</button>
    </div>
    <div id="website-iframe-container" class="iframe-container">
        <iframe id="website-preview-iframe" src="about:blank" frameborder="0"></iframe>
    </div>
    <button id="pay-button" class="launch-button">LAUNCH!</button>
</div>
        </div>
    </div>
</div>
    <!-- Footer placeholder -->
<div id="site-footer"></div>

<script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script src="config.js"></script>
<script src="dashboard.js"></script>
    <script src="footer.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" charset="utf-8">
// ---- TEXT EDIT MODE TOGGLE ----
const toggleEditBtn = document.getElementById("toggle-edit-btn");
const saveEditBtn = document.getElementById("save-edit-btn");
let editMode = false;
let iframeDoc;

toggleEditBtn.addEventListener("click", () => {
    const iframe = document.getElementById("website-preview-iframe");
    if (!iframe) return alert("No iframe found");
    
    iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
    const editableEls = iframeDoc.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span,button,a");
    
    editableEls.forEach(el => el.setAttribute("contenteditable", "true"));
    editMode = true;
    
    // Toggle buttons
    toggleEditBtn.style.display = "none";
    saveEditBtn.style.display = "inline-block";
});

saveEditBtn.addEventListener("click", async () => {
    if (!iframeDoc) return alert("Nothing to save");
    
    const updatedHTML = iframeDoc.documentElement.outerHTML;
    
    try {
        const user = firebase.auth().currentUser;
        if (!user) return alert("Not signed in");
        const idToken = await user.getIdToken(true);
        
        const repoFullName = window.currentRepoFullName || prompt("repo (owner/repo)");
        
        const resp = await fetch("/api/updateFile", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${idToken}`,
            },
            body: JSON.stringify({
                repoFullName,
                filePath: "index.html",
                newContent: updatedHTML,
                commitMessage: "Text updated via GoStarterAI editor"
            }),
        });
        
        const result = await resp.json();
        if (!resp.ok) return alert("Update failed: " + (result.error || JSON.stringify(result)));
        
        alert("Site updated successfully! ðŸš€");
        document.getElementById("website-preview-iframe").srcdoc = updatedHTML;
        
        // Turn off edit mode
        const editableEls = iframeDoc.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span,button,a");
        editableEls.forEach(el => el.removeAttribute("contenteditable"));
        editMode = false;
        
        // Toggle buttons
        toggleEditBtn.style.display = "inline-block";
        saveEditBtn.style.display = "none";
        
    } catch (err) {
        console.error(err);
        alert("Error saving changes: " + err.message);
    }
});
</script>
</body>
</html>